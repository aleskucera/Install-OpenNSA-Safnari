---
#------------------GENERAL------------------
prerequisites: [ 'openssl', 'libssl-dev', 'libssl-doc', 'python-dev', 'python3-virtualenv', 'build-essential', 'postgresql', 'libpq-dev', 
                'postgresql-contrib', 'python3-psycopg2', 'acl', 'apache2', 'maven', 'zip', 'openjdk-8-jdk', 'sbt']

# General
app_user: "opennsa"
home_path: "/opt/{{ app_user }}" 
config_path: "/etc/{{ app_user }}"

# Apache
apache2_modules: ['ssl', 'proxy', 'proxy_http', 'proxy_balancer', 'lbmethod_byrequests', 'proxy_ajp', 'rewrite', 'deflate',
                 'headers', 'proxy_balancer', 'proxy_connect', 'proxy_html']

# PostgeSQL
postgres_user: "{{ app_user }}"

# Configuration files
opennsa_environment: "opennsa_environment"
opennsa_tac: "opennsa_node.tac"
opennsa_service: "opennsa3.service"
opennsa_conf: "opennsa3.conf"
opennsa_nrm: "opennsa3-prex.nrm"

# Configuration templates
templates:
  - { path: 'opennsa_environment.j2', name: '{{ opennsa_environment }}' }
  - { path: 'opennsa_node.tac.j2', name: '{{ opennsa_tac }}' }
  - { path: 'opennsa.service.j2', name: '{{ opennsa_service }}' }
  - { path: 'opennsa.conf.j2', name: '{{ opennsa_conf }}' }
  - { path: 'opennsa.nrm.j2', name: '{{ opennsa_nrm }}' }

repos: { 
  opennsa: { link: 'https://gitlab.geant.org/hazlinsky/opennsa3.git', folder: '{{ home_path }}/opennsa' },
  safnari: { link: 'https://github.com/BandwidthOnDemand/nsi-safnari.git', folder: '{{ home_path }}/safnari' },
  dds: { link: 'https://github.com/BandwidthOnDemand/nsi-dds.git', folder: '{{ home_path }}/nsi-dds' },
  pce: { link: 'https://github.com/BandwidthOnDemand/nsi-pce.git', folder: '{{ home_path }}/nsi-pce' }
  }

databases: {
  opennsa: "{{ app_user }}-opennsa",
  safnari: "{{ app_user }}-safnari"
  }

# SSL
cert_dir: /etc/ssl/certs
certificate_dest: /etc/ssl/certs/nsi_vm_cesnet_cz.pem
key_dest: /etc/ssl/private/nsi_vm_cesnet_cz.key

certificate_src: "{{ hosts_dir }}/files/certificate.pem"
key_src: "{{ hosts_dir }}/files/private_key.pem"

#------------------CONFIG------------------

#opennsa.cesnet.cz

# Enviroment
opennsa: "{{ home_path }}/repo"
opennsa_venv: "{{ home_path }}/venv"
python_path: "{{ home_path }}/repo"

# .conf
domain: "nsi.cesnet.cz:2021" 
logfile: "/opt/opennsa/opennsa3.log" 
host: "opennsa.cesnet.cz"
policy: "allowhairpin" 
nrmmap: "/etc/opennsa/opennsa3-prex.nrm"

# .service
description: "OpenNSA3 node"
after: "syslog.target network.target"
config_file: "{{ config_path }}/opennsa3.conf"
remote_debug: "0"
enviroment_file: "{{ config_path }}/opennsa_environment"
node_file: "{{ config_path }}/opennsa_node.tac"
working_directory: "{{ home_path }}/repo"
restart: "always"
wanted_by: "multi-user.target"
